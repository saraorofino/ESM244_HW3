---
title: "ESM 244 HW 3"
author: "Sara Orofino"
date: "2/28/2019"
output: 
  html_document:
  css: custom.css
  toc: true
---
#{.tabset}

```{r setup, include=FALSE, message = FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(lubridate)
library(tseries)
library(forecast)
library(sf)
library(tmap)
library(leaflet)
library(ggrepel)
library(ggspatial)
library(RColorBrewer)
library(raster)
```

##Task 1 

Text

##Task 2

###Truckee River Flows

a. Create timeseries data and visualize decomposed data:  

```{r, message=FALSE}

truckee <- read_csv("truckee_flow.csv")

# Convert to ts data
truckee_ts <- ts(truckee$mean_flow, frequency = 12, start = c(2000,1))

#Visualize it:
#plot(truckee_ts)

# Decompose ts data:
truckee_dc <- decompose(truckee_ts)

#Visualize it:
plot(truckee_dc)


```

Explain Timeseries:  

b. Holt-Winters and ARIMA for forecasting:  

```{r}

########### Holt-winters:

truckee_hw <- HoltWinters(truckee_ts)
#plot(truckee_hw)

# Forecast:
truckee_forecast_hw <- forecast(truckee_hw, h = 60)
#plot(truckee_forecast_hw)


########### ARIMA:

# Find pdq with auto arima:
truckee_pdq <- auto.arima(truckee_ts)
#truckee_pdq

# Non-seasonal (2,1,1)
# Seasonal (0,0,2)

# Fit ARIMA with pdq inputs:
truckee_arima <- arima(truckee_ts, order = c(2,1,1), seasonal = list(order = c(0,0,2)))

# Forecast ARIMA:
truckee_forecast_arima <- forecast(truckee_arima, h = 72)
#plot(truckee_forecast_arima)

### Graph it:

# Data frame with predictions:
truckee_df <- data.frame(truckee_forecast_hw)

month_seq <- seq(1,60)
truckee_df_2 <- data.frame(month_seq, truckee_df)

ggplot(truckee_df_2, aes(month_seq, y = Point.Forecast)) +
  geom_line() + 
  scale_x_continuous(expand = c(0,0), limits = c(0, 60.5), breaks = seq(0,60, by = 10)) +
  scale_y_continuous(expand = c(0,0), limits = c(0,225)) +
  labs(y = "Forecast Truckee River Flows (cfs)", 
       x = "Months\n(Month 0 = October 2016)") +
  theme_bw()
```
**Figure Caption.**  

c. Model Residuals:    

```{r}

# Residuals for HW model:
par(mfrow = c(1,2))
hist(truckee_forecast_hw$residuals) 
qqnorm(truckee_forecast_hw$residuals)

# Residuals for ARIMA:
par(mfrow = c(1,2))
hist(truckee_arima$residuals) 
qqnorm(truckee_arima$residuals)


```



##Task 3
###Mapping California National Parks  

```{r}
# Read in CA counties shapefile and set crs to WGS84:

ca_counties <- read_sf(".", layer = "california_county_shape_file")
st_crs(ca_counties) = 4326 


# Read in NPS data and set crs to WGS84:
ca_nps <- read_sf(".", layer = "nps_boundary") %>% 
  filter(STATE == "CA", UNIT_TYPE == "National Park") %>% 
  st_simplify(dTolerance = 100)
st_crs(ca_nps) = 4326


#Colors for map:
color_count <- 9
my_colors  <- colorRampPalette(brewer.pal(8, "Set2"))(color_count)

# CA National Parks graph:
ggplot(ca_counties) +
  geom_sf(fill = "NA",
          color  = "grey30",  
          size =  0.1) +
  geom_sf(data = ca_nps, aes(fill= UNIT_NAME)) 
```


##Task 4
###Lizards in the Northern Chihuahuan Desert 


a. For all lizards trapped at site ‘CALI’, do weights of male and female adult lizards differ
significantly?  

```{r warning=FALSE, message=FALSE}

# Read in data set filter for adult male and female lizards at site 'CALI'
lizard <- read_csv("lizard_clean.csv") %>% 
  filter(site == "CALI") %>% 
  filter(sex == "M" | sex == "F")

# Visualize distributions with histograms 
lizard_male <- lizard %>%
  filter(sex == "M") 

ggplot(lizard_male, aes(x=weight)) +
  geom_histogram(stat = "count")

lizard_female <- lizard %>%
  filter(sex == "F") 

ggplot(lizard_female, aes(x=weight)) +
  geom_histogram(stat = "count")
```

